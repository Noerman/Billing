;(function(){var e={init:function(){this.facebook.setup();this.form.setup()},form:{setup:function(){this.emailChange();$(".apollo-register-account .register-link").click(function(e){e.preventDefault();$(".apollo-login").fadeOut(350,function(){$(".apollo-register").fadeIn(350,function(){$(".apollo-register input:first").focus()});$(".apollo").addClass("register")})});$(".apollo-back a").click(function(e){e.preventDefault();$(".apollo-register:visible, .apollo-forgotten-password:visible").fadeOut(350,function(){$(".apollo-login").fadeIn(350)})});$(".apollo-register-account .password-link").click(function(e){e.preventDefault();$(".apollo-login").fadeOut(350,function(){$(".apollo-forgotten-password").fadeIn(350,function(){$(".apollo-forgotten-password input:first").focus()});$(".apollo").addClass("forgotten-password")})});$("#apollo-register-form").submit(function(t){t.preventDefault();e.form.handleRegister($(this))});$("#apollo-forgotten-password-form").submit(function(t){t.preventDefault();e.form.handleForgottenPassword($(this))});$("#apollo-login-form").submit(function(t){t.preventDefault();e.form.handleStandardLogin($(this))})},emailChange:function(){$(".email").change(function(){var e=$(this),t=MD5($.trim(e.val().toLowerCase())),n="http://www.gravatar.com/avatar/"+t+"?d=http://tidy.eideus.com/img/avatar.png&s=205";$(".apollo-image").css("backgroundImage","none");$("<img />").attr("src",n).imagesLoaded(function(){$(".apollo-image").css("backgroundImage","url("+n+")")})})},handleStandardLogin:function(t){if(e.checkUserAccount("standard",t)){$(".apollo-login").fadeOut(350,function(){$(".apollo-logging-in").fadeIn(350)})}else{var n=$(".apollo-login"),r=n.find('[type="text"]').parents(".control-group"),i=n.find('[type="password"]').parents(".control-group");i.addClass("error");r.addClass("error").find("input").popover({title:"Ooops!",content:"Your email address / password appear to be incorrect. Please verify them and try logging in again.",trigger:"manual",placement:"right"}).popover("show")}},handleRegister:function(t){var n=$("#firstName").val(),r=t.serialize();if(e.checkUserAccount("register",t)){var i=$(".apollo-register"),s=i.find('[type="text"]:first').parents(".control-group");s.addClass("error").find("input:first").popover({title:"Ooops!",content:"It looks like you already have an account with that email address.",trigger:"manual",placement:"right"}).popover("show")}else{if(n.length){$(".user-name").text(", "+n)}$(".apollo-register").fadeOut(350,function(){$(".apollo-registering").fadeIn(350)})}},handleForgottenPassword:function(t){if(e.checkUserAccount("forgottenPassword",t)){$(".apollo-forgotten-password").fadeOut(350,function(){$(".apollo-password-reset").fadeIn(350)})}else{var n=$(".apollo-forgotten-password"),r=n.find('[type="text"]:first').parents(".control-group");r.addClass("error").find("input:first").popover({title:"Ooops!",content:"It looks like we don't have an account registered with that email address.",trigger:"manual",placement:"right"}).popover("show")}}},checkUserAccount:function(e,t){return $('[name="optionsRadios"]:checked').val()=="yes"},facebook:{setup:function(){window.fbAsyncInit=function(){FB.init({appId:"465771293512015",channelUrl:"//tidy.eideus.com/js/lib/channel.js",status:true,xfbml:true});e.facebook.init()};(function(e,t,n){var r,i=e.getElementsByTagName(t)[0];if(e.getElementById(n)){return}r=e.createElement(t);r.id=n;r.src="//connect.facebook.net/en_US/all.js";i.parentNode.insertBefore(r,i)})(document,"script","facebook-jssdk")},init:function(){$(".btn-facebook").on("click",function(t){t.preventDefault();FB.login(function(t){e.facebook.loginSuccess(t)},{scope:"email"})});FB.getLoginStatus(function(t){e.facebook.loginSuccess(t)},{scope:"email"})},loginSuccess:function(t){if(t.status==="connected"){var n=t.authResponse.userID,r=t.authResponse.accessToken;FB.api("/me",function(t){$(".apollo-image").css("backgroundImage","none");var n="http://graph.facebook.com/"+t.username+"/picture?width=205&height=205",r=$("<img />").attr("src",n).imagesLoaded(function(){$(".apollo-image").css("backgroundImage","url("+n+")")});if(e.checkUserAccount("facebook",t)){$(".user-name").text(", "+t.first_name);$(".apollo-login").fadeOut(350,function(){$(".apollo-logging-in").fadeIn(350)})}else{$("#firstName").val(t.first_name);$("#lastName").val(t.last_name);$("#registerEmail").val(t.email);$(".apollo-login").fadeOut(350,function(){$(".apollo-register").fadeIn(350,function(){$('#apollo-register-form [type="password"]:first').focus()})})}})}}},domReady:function(){},windowLoad:function(){}};e.init();$(function(){e.domReady();$(window).load(e.windowLoad)})})(jQuery)