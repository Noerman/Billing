<?phpnamespace App\AdminBundle\Business\Client;use App\AdminBundle\Business;use App\ClientBundle\Entity;class ImportProcess{    public $container;    public function __construct($container)    {        $this->container = $container;    }    public function doImport()    {        $fileName = $this->container->get('request')->query->get('fileName', false);        $tempFolder = $this->container->getParameter('temp_upload_dir');        if (!$fileName || !file_exists($tempFolder . '/' . $fileName)) {            return array('success' => '0', 'failed' => 'All');        }        $noSuccess = 0;        $noFailed = 0;        $r = Utils::parseCsv($this->container, $tempFolder . '/' . $fileName);        if (!empty($r['errors'])) {            return array('success' => '0', 'failed' => 'All');        }        $em = $this->container->get('doctrine')->getEntityManager();        $helperCommon = $this->container->get('app_admin.helper.common');        $helperUser = $this->container->get('app_admin.helper.user');        foreach ($r['result'] as $row) {            $client = new Entity\ClientDetail();            if ($row['message'] == 'OK') {                $helperCommon->copyArrayToEntity($row, $client);                if (isset($row['password'])) {                    $client->setPassword($helperUser->encodePassword($row['password']));                    $client->setStatus(0);                }                $em->persist($client);                $noSuccess++;            } else {                $noFailed++;            }        }        $em->flush();        return array(            'success' => $noSuccess,            'failed'  => $noFailed        );    }}