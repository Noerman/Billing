<?phpnamespace App\AdminBundle\Business\EstimatePayment;use App\AdminBundle\Business;use App\ClientBundle\Entity;class Utils{    public static function refund($controller, $idPayment)    {        $doctrine = $controller->get('doctrine');        $em = $doctrine->getEntityManager();        $payment = $doctrine->getRepository('AppClientBundle:ClientPayment')->findOneById($idPayment);        if ($payment) {            $estimate = $doctrine->getRepository('AppClientBundle:ClientEstimate')->findOneById($payment->getIdEstimate());            if ($estimate) {                $refundPayment = new Entity\ClientPayment();                $refundPayment->setIdGateway($payment->getIdGateway());                $refundPayment->setTransaction("Refund transaction: " . $payment->getTransaction());                $refundPayment->setPayDate(new \DateTime());                $refundPayment->setAmount($payment->getAmount() * -1);                $refundPayment->setIdEstimate($estimate->getId());                $refundPayment->setIdType(2);                $payment->setIdType(1);                $em->persist($payment);                $em->persist($refundPayment);                $em->flush();                return true;            }        }        return false;    }}